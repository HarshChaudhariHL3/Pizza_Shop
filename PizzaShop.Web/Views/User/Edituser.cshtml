@{
    ViewData["Title"] = "Edit User Page";
}

@model PizzaShop.Entity.ViewModel.EdituserViewModel

<div class="row">
    <div class="col-lg-12 d-flex justify-content-between">
        <div>
            <h2>Edit User</h2>
        </div>
        <div>
            <div class="input-group">
                <div class="d-flex align-items-center">
                    <div class="border">
                        <a asp-controller="User" asp-action="Users" class="btn border border-info" role="button"><i
                                class="bi bi-arrow-left"></i>Back</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form enctype="multipart/form-data" asp-action="Edituser" asp-controller="User">
        <div class=" mt-3  p-3 bg-white rounded">
            <div class="row">
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="fname" asp-for="FirstName" placeholder="FirstName">
                        <label asp-for="FirstName">FirstName</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" asp-for="LastName" id="lname" placeholder="LastName">
                        <label asp-for="LastName">LastName</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" asp-for="Username" id="uname" placeholder="Username">
                        <label asp-for="Username">Username</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <select class="form-select" id="roleSelect" aria-label="Floating label select example"
                            asp-for="Role">

                        </select>
                        <label for="roleSelect">Role</label>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" asp-for="Email" id="floatingInput"
                            placeholder="name@example.com">
                        <label asp-for="Email">Email address</label>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        <select class="form-select" id="statusSelect" aria-label="Floating label select example"
                            asp-for="Status">
                            <option value="True">Active</option>
                            <option value="False">InActive</option>
                        </select>
                        <label for="statusSelect">Status</label>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div
                    class="rounded col-12 form-control pt-4 pb-4 d-flex align-items-center justify-content-center border border-dotted border-5">


                    <div class="d-flex flex-column justify-content-center align-items-center">
                        <h3><i class="bi bi-cloud-arrow-up"></i></h3>
                        <label for="formfile" class="form-label">
                            <img src="images/cloud-upload-icon.svg" alt="">Browse Files
                        </label>
                        <input type="file" class="form-control d-none" id="formfile">
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col">
                    <div class="form-floating">
                        <select class="form-select" id="countrySelect" aria-label="Floating label select example"
                            asp-for="Country">
                        </select>
                        <label for="countrySelect">Country</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating">
                        <select class="form-select" id="stateSelect" aria-label="Floating label select example"
                            asp-for="State">
                        </select>
                        <label for="stateSelect">State</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating">
                        <select class="form-select" id="citySelect" aria-label="Floating label select example"
                            asp-for="City">
                        </select>
                        <label for="citySelect">City</label>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" asp-for="ZipCode" id="fname" placeholder="Zipcode">
                        <label asp-for="ZipCode">Zipcode</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" asp-for="Address" id="fname" placeholder="Address">
                        <label asp-for="Address">Address</label>
                    </div>
                </div>
                <div class="col">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" asp-for="Phone" id="fname" placeholder="Phone">
                        <label asp-for="Phone">Phone</label>
                    </div>
                </div>
            </div>

            <div>
                <button type="submit" class="p-2 rounded">Update User</button>
                <button class="p-2 rounded" asp-controller="User" asp-action="Users">Cancel</button>
            </div>
        </div>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajaxy/1.6.1/scripts/jquery.ajaxy.min.js"></script>

<script>
    $(document).ready(function () {

        $.ajax({
            url: '/User/GetRoles',
            type: 'GET',
            success: function (data) {
                console.log(data);
                
                $.each(data, function (index, Role) {
                    if (Role.roleId == @Model.Role) {
                        $('#roleSelect').append(`<option value="${Role.roleId}" selected>${Role.roleName}</option>`);
                    }
                    else
                    $('#roleSelect').append(`<option value="${Role.roleId}">${Role.roleName}</option>`);
                });
            }
        });

        $.ajax({
            type: 'GET',
            url: '/User/GetCountries',
            success: function (data) {
                console.log(data);
                var s = '<option value="-1">Please select a country</option>';
                for (var i = 0; i < data.length; i++) {
                    if (data[i].countryId == @Model.Country) {
                        s += '<option value="' + data[i].countryId + '" selected>' + data[i].countryName + '</option>';
                    }
                    else {
                        s += '<option value="' + data[i].countryId + '">' + data[i].countryName + '</option>';
                    }
                }
                $("#countrySelect").html(s);
            }
        });
        $.ajax({
            type: 'GET',
            url: '/User/GetStates',
            data: { CountryId: @Model.Country },
            success: function (data) {
                console.log(data);
                var s = '<option value="-1">Please select a state</option>';
                for (var i = 0; i < data.length; i++) {
                    if (data[i].stateId == @Model.State) {
                        s += '<option value="' + data[i].stateId + '" selected>' + data[i].stateName + '</option>';
                    }
                    else {
                        s += '<option value="' + data[i].stateId + '">' + data[i].stateName + '</option>';
                    }
                }
                $("#stateSelect").html(s);
            }
        });
        $.ajax({
            type: 'GET',
            url: '/User/GetCities',
            data: { stateId: @Model.State },
            success: function (data) {
                console.log(data);
                var s = '<option value="-1">Please select a city</option>';
                for (var i = 0; i < data.length; i++) {
                    if (data[i].cityId == @Model.City) {
                        s += '<option value="' + data[i].cityId + '" selected>' + data[i].cityName + '</option>';
                    }
                    else {
                        s += '<option value="' + data[i].cityId + '">' + data[i].cityName + '</option>';
                    }
                }
                $("#citySelect").html(s);
            }
        });
    });

    $('#countrySelect').change(function () {
        var countryId = $(this).val();
        $('#stateSelect').empty().append('<option selected>Select state</option>').prop('disabled', false);
        $.ajax({
            type: 'GET',
            url: '/User/GetStates',
            data: { CountryId: countryId },
            success: function (data) {
                debugger;
                console.log(data);
                var s = '<option value="-1">Please select a state</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].stateId + '">' + data[i].stateName + '</option>';
                }
                $("#stateSelect").html(s);
            }
        });
    });

    $('#stateSelect').change(function () {
        var stateId = $(this).val();
        $('#citySelect').empty().append('<option selected>Select city</option>').prop('disabled', false);
            $.ajax({
                type: 'GET',
                url: '/User/GetCities',
                data: { stateId: stateId },
                success: function (data) {
                    var s = '<option value="-1">Please select a city</option>';
                    for (var i = 0; i < data.length; i++) {
                        s += '<option value="' + data[i].cityId + '">' + data[i].cityName + '</option>';
                    }
                    $("#citySelect").html(s);
                }
            });
    });
</script>
